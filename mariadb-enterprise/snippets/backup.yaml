- name: backup
  image: {{ .Values.mariadb.backup.image }}
  command:
    - flask
    - run
    - --host=0.0.0.0
    - --port=80
  #imagePullPolicy: IfNotPresent
  imagePullPolicy: Always
  env:
  - name: CLUSTER_TOPOLOGY
    value: {{ .Values.mariadb.cluster.topology }}
  - name: FLASK_APP
    value: /python/backup/app.py
  - name: FLASK_ENV
    value: development
  volumeMounts:
  - name: backup-data-storage
    mountPath: /backup-storage
  - name: mariadb-secrets-vol
    mountPath: "/etc/hmac-secret"
    readOnly: true
  # a permanent volume for data storage
{{- if or (eq .Values.mariadb.cluster.topology "columnstore-standalone") (eq .Values.mariadb.cluster.topology "columnstore") }}
  - name: mariadb-config-vol
    mountPath: /mnt/config-map
{{ tpl ( .Files.Get "snippets/columnstore-volumeMounts.yaml" ) . | indent 2 }}
{{- else }}
  - name: data
    mountPath: /var/lib/mysql
    subPath: mysql
  - name: mariadb-socket-vol
    mountPath: /var/run/mysqld
{{- end }}